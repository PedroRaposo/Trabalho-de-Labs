# -*- coding: utf-8 -*-
"""
Created on Wed Dec  9 12:44:22 2015

@author: Emanuel
"""

#from Bio import Entrez
#from Bio import SeqIO
#Entrez.email = "emanuel_queiroga1@hotmail.com" 

#Gives the names of NCBI's databases
#handle = Entrez.einfo()
#result = handle.read()
#print(result)

#handle = Entrez.efetch(db="nucleotide", term="NC_000919", rettype="gb", retmode="text")
#record = SeqIO.read(handle, "genbank")
#handle.close()
#print(record)

import os
from Bio import SeqIO
from Bio import Entrez
from Bio import SwissProt
import re
Entrez.email = "emanuel_queiroga1@hotmail.com"     # Always tell NCBI who you are
genoma = "genoma.gb"
ls = []    
file = open(genoma)
for line in file: # abrir o ficheiro GenBank
    ls.append(line)
#print(ls)

procura = 1 #procurar gene / 2 procura xref

geneExpression= "[\s]*gene[\s]+[0-9]+..[0-9]+"
cdsExpression= "[\s]*CDS[\s]+[0-9]+..[0-9]+"
xref = "/db_xref"
xrefGi = "/db_xref=\"GI:"
geneId = "/db_xref=\"GeneID:"
geneInterval="[^\s]*[^gene][^\s]+[0-9]+..[0-9]+"
cdsInterval
contaGi =0
contaId =0
contaCDS =0
for line in ls: # ler linha a linha o ficheiro GenBank
    if procura==3:
        pAN = re.search(xrefGi,line)
        if pAN != None: 
            contaGi+=1
            procura=1
        pAN = re.search(geneExpression,line)
        if pAN != None:
            procura=2
        pAN = re.search(geneId,line)
        if pAN != None: 
            print(line)
            contaId+=1
            procura=1
                
    pAN = re.search(cdsExpression,line)
    if pAN != None: 
            contaCDS+=1
            procura = 3
            
    if procura == 1:
        pAN = re.search(geneExpression,line) # procurar a palavra ACCESSION em cada linha,
    #print(line)
        if pAN != None: 
            procura = 2
    if procura == 2:
        pAN = re.search(xref,line)
        if(pAN != None):
           # print(line)
            procura=1

print(contaCDS)
print(contaId)
print(contaGi)
# if not os.path.isfile(filename):
#     # Downloading...
#     net_handle = Entrez.efetch(db="nucleotide",id="499183920",rettype="gb", retmode="text")
#     out_handle = open(filename, "w")
#     out_handle.write(net_handle.read())
#     out_handle.close()
#     net_handle.close()
#     print("Saved")
# 
# print("Parsing...")
# record = SeqIO.read(filename, "genbank")
# print(record)
# 
# print(record.id)
